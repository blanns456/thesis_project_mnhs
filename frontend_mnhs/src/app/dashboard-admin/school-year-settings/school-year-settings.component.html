<div class="container-dashboard bgcontent">
  <app-sidebar-admin></app-sidebar-admin>

  <div class="main-content">
    <div class="background"></div>

    <app-navbar></app-navbar>

    <div class="container-fluid vh-100 q-link">
      <p-card header="School Year Settings">
        <form
          [formGroup]="school_year_form"
          (ngSubmit)="submit_school_year()"
          class="p-3">
          <div class="row">
            <div class="col-4">
              <label for="school_year">School Year (S.Y.)</label>
              <p-calendar
                id="school_year"
                formControlName="school_year"
                view="year"
                selectionMode="range"
                dateFormat="yy"
                [required]="true"
                [style]="{ width: '100%' }"
                [showIcon]="true">
              </p-calendar>
              <small
                class="text-danger"
                *ngIf="school_year_form.get('school_year')?.errors?.['required'] && (school_year_form.get('school_year')?.touched || submitted)">
                School Year is required.
              </small>
            </div>

            <div class="col-4">
              <label for="school_year_duration">School Year Duration</label>
              <p-calendar
                id="school_year_duration"
                formControlName="school_year_duration"
                selectionMode="range"
                [readonlyInput]="true"
                [style]="{ width: '100%' }"
                [showButtonBar]="true"
                [numberOfMonths]="2"
                [required]="true"
                [showIcon]="true"
                [touchUI]="true">
              </p-calendar>
              <small
                class="text-danger"
                *ngIf="school_year_form.get('school_year_duration')?.errors?.['required'] && (school_year_form.get('school_year_duration')?.touched || submitted)">
                School Year Duration is required.
              </small>
            </div>

            <div class="col-4">
              <label for="enrollment_duration">Enrollment Duration</label>
              <p-calendar
                id="enrollment_duration"
                formControlName="enrollment_duration"
                selectionMode="range"
                [readonlyInput]="true"
                [style]="{ width: '100%' }"
                [showButtonBar]="true"
                [numberOfMonths]="2"
                [required]="true"
                [showIcon]="true"
                [touchUI]="true">
              </p-calendar>
              <small
                class="text-danger"
                *ngIf="school_year_form.get('enrollment_duration')?.errors?.['required'] && (school_year_form.get('enrollment_duration')?.touched || submitted)">
                Enrollment Duration is required.
              </small>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col-12 text-center">
              <p-button type="submit">Create School Year</p-button>
            </div>
          </div>
        </form>

        <div class="mt-4">
          <h3>School Year List</h3>

          <div class="mb-3">
            <div class="row">
              <div class="col-md-3">
                <input
                  pInputText
                  [(ngModel)]="searchTerm"
                  placeholder="Search..."
                  (keyup.enter)="search()">
              </div>

              <div class="col-md-3">
                <p-calendar
                  [(ngModel)]="searchSchoolStart"
                  dateFormat="yy-mm-dd"
                  placeholder="School Start Date">
                </p-calendar>
              </div>

              <div class="col-md-3">
                <p-calendar
                  [(ngModel)]="searchSchoolEnd"
                  dateFormat="yy-mm-dd"
                  placeholder="School End Date">
                </p-calendar>
              </div>

              <div class="col-md-3">
                <p-button
                  (click)="search()"
                  label="Search"></p-button>
              </div>
            </div>
          </div>

          <p-table [value]="schoolYears">
            <ng-template pTemplate="header">
              <tr>
                <th>School Year</th>
                <th>Status</th>
                <th>Enrollment Status</th>
                <th>School Start</th>
                <th>School End</th>
                <th>Actions</th>
              </tr>
            </ng-template>

            <ng-template
              pTemplate="body"
              let-year>
              <tr>
                <td>{{ year.school_year }}</td>
                <td>{{ year.status }}</td>
                <td>{{ year.enrollment_status }}</td>
                <td>{{ year.school_start }}</td>
                <td>{{ year.school_end }}</td>
                <td>
                  <p-button
                    icon="pi pi-pencil"
                    class="p-button-rounded p-button-success"
                    (click)="editSchoolYear(year)"></p-button>
                  <p-button
                    icon="pi pi-trash"
                    class="p-button-rounded p-button-danger"
                    (click)="deleteSchoolYear(year.id)"></p-button>
                </td>
              </tr>
            </ng-template>
          </p-table>

          <div class="mt-3">
            <p-button
              (click)="prevPage()"
              [disabled]="currentPage === 1"
              label="Previous"></p-button>
            <span class="mx-2">Page {{ currentPage }} of {{ totalPages }}</span>
            <p-button
              (click)="nextPage()"
              [disabled]="currentPage === totalPages"
              label="Next"></p-button>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</div>
